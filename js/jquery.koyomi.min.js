!function(n){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a={init:function(t){var s=n.extend(!0,{year:e.getFullYear(),month:e.getMonth()+1,headLabel:"%year% %month%",prevNext:!0,prevSign:"＜",nextSign:"＞",useJapaneseEra:0,japaneseEras:[{name:"明治",firstDate:"1868-01-25",lastDate:"1912-07-29"},{name:"大正",firstDate:"1912-07-30",lastDate:"1926-12-24"},{name:"昭和",firstDate:"1926-12-25",lastDate:"1989-01-07"},{name:"平成",firstDate:"1989-01-08"}],weekBeginning:0,dowClass:["sun","mon","tue","wed","thu","fri","sat"],url:"http://example.com/%year%/%month%/%day%/",eventDates:{dates:[],yearly:[],monthly:[]},language:"en",dowLabel:"dowShort",monthLabel:"monthShort"},t);return this.each(function(){var t=n(this),e=i(t,s),a=new r(t,e);a.settings.FirstDay=new Date(a.settings.year,a.settings.month-1,1),a.settings.LastDay=new Date(a.settings.year,a.settings.month,0),a.buildKoyomi(),a.load(),n(t).on("click","div.prev,div.next",function(){switch(!0){case"prev"===n(this).attr("class"):a.settings.month=a.settings.month-1;break;case"next"===n(this).attr("class"):a.settings.month=a.settings.month+1}a.settings.FirstDay=new Date(a.settings.year,a.settings.month-1,1),a.settings.LastDay=new Date(a.settings.year,a.settings.month,0),t.empty(),a.buildKoyomi(),a.load()}),n(t).on("click","div.number",function(){window.location.href=$(this).data("url")})})}},l=function(t,e){var a=t;return{getWeekNum:function(){return(a+e)%7},getCellNum:function(){return a%7},countUp:function(){return a++}}};n.fn.koyomi=function(t){return a[t]?a[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void n.error("Method "+t+" does not exist on jQuery.koyomi"):a.init.apply(this,arguments)};var s,i=function(t,e){return n.extend(!0,{},e,t.data())},u=function(t,e){return(Array(e).join("0")+t).slice(-e)},d=function(t){var e=t.split("-");return new Date(e[0],e[1]-1,e[2])},r=(s=function(t,e){this.$el=t,this.settings=e},n.extend(s.prototype,{},{load:function(){var a=this.$el,s=this.settings;$.each(s.eventDates.dates,function(t,e){$(a).find(".date_"+e.date).addClass(e.class?e.class:"eventday")}),$.each(s.eventDates.yearly,function(t,e){$(a).find(".date_"+s.FirstDay.getFullYear()+"-"+e.date).addClass(e.class?e.class:"eventday")}),$.each(s.eventDates.monthly,function(t,e){$(a).find(".date_"+s.FirstDay.getFullYear()+"-"+u(s.FirstDay.getMonth()+1,2)+"-"+u(e.date,2)).addClass(e.class?e.class:"eventday")}),$(a).find(".date_"+t.getFullYear()+"-"+u(t.getMonth()+1,2)+"-"+u(t.getDate(),2)).addClass("today")},buildKoyomi:function(){var t="";t+='<div class="koyomi">',t+="<table>",t+=this.buildHead(),t+=this.buildMain(),t+="</table>",t+="</div>",this.$el.append(t)},buildHead:function(){var t=o(this.settings.language,this.settings.monthLabel),e=this.settings.headLabel;e=(e=e.replace("%month%",t[this.settings.FirstDay.getMonth()])).replace("%year%",this.settings.FirstDay.getFullYear()),this.settings.useJapaneseEra&&(e=e.replace("%era%",this.getJapaneseEra()));var a=7,s=$("<tr></tr>");return this.settings.prevNext&&(a=5,s.append($("<td></td>").append($('<div class="prev"></div>').text(this.settings.prevSign)))),$(s).append($('<td colspan="'+a+'">').append($('<div class="headLabel"></div>').text(e))),this.settings.prevNext&&s.append($("<td></td>").append($('<div class="next"></div>').text(this.settings.nextSign))),$("<thead></thead>").append(s).prop("outerHTML")},buildMain:function(){new Date(this.settings.FirstDay.getFullYear(),this.settings.FirstDay.getMonth()+1,0);var t=l(0,this.settings.weekBeginning),a=this.initWeekObject(),e=$("<tbody></tbody>"),s=$("<tr></tr>");if(Object.keys(a).forEach(function(t,e){s.append($("<th></th>").addClass(a[t].class).text(a[t].name))}),$(e).append(s),this.settings.weekBeginning!=this.settings.FirstDay.getDay())for(s=$("<tr></tr>");t.getWeekNum()!=this.settings.FirstDay.getDay();)s.append($("<td></td>").addClass(this.settings.dowClass[t.getWeekNum()])),t.countUp();for(var n=1;n<=this.settings.LastDay.getDate();n++){var i=new Date(this.settings.FirstDay.getFullYear(),this.settings.FirstDay.getMonth(),n);t.getCellNum()||(s=$("<tr></tr>"));var r=[];r.push(this.settings.dowClass[t.getWeekNum()]),r.push("date_"+i.getFullYear()+"-"+u(i.getMonth()+1,2)+"-"+u(i.getDate(),2));var o=this.settings.url;o=(o=(o=o.replace("%year%",this.settings.FirstDay.getFullYear())).replace("%month%",this.settings.FirstDay.getMonth()+1)).replace("%day%",n);var d=$("<div></div>").attr("data-url",o).addClass("number").text(n);s.append($("<td></td>").addClass(r.join(" ")).append(d)),t.countUp(),t.getCellNum()||e.append(s)}if(t.getCellNum()){for(;t.getCellNum();)s.append($("<td></td>").addClass(this.settings.dowClass[t.getWeekNum()])),t.countUp();e.append(s)}return e.prop("outerHTML")},initWeekObject:function(){for(var t=o(this.settings.language,this.settings.dowLabel),e=l(this.settings.weekBeginning,this.settings.weekBeginning),a=new Object,s=0;s<7;s++)a[s]={name:t[e.getCellNum()],class:this.settings.dowClass[e.getCellNum()]},e.countUp();return a},getJapaneseEra:function(){var r=this.settings,o=[];return $.each(r.japaneseEras,function(t,e){var a,s,n=d(e.firstDate);if(void 0!==e.lastDate)var i=d(e.lastDate);switch(!0){case n.getTime()<=r.LastDay.getTime()&&void 0===e.lastDate:case n.getTime()<=r.FirstDay.getTime()&&i.getTime()>=r.FirstDay.getTime():o.push((a=e.name,1==(s=r.FirstDay.getFullYear()+1-n.getFullYear())?a+"元年":a+s+"年"))}}),o.join("/")},_bind:function(t){var e=this;return function(){e[t].apply(e,arguments)}}}),s),o=function(t,e){switch(void 0!==t&&!1!==t||(t="en"),t){case"en":var a={dow:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dowShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month:["January","February","March","April","May","June","July","August","September","October","November","December"],monthShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};break;case"es":a={dow:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],dowShort:["Do","Lu","Ma","Mi","Ju","Vi","Sá"],month:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],monthShort:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"]};break;case"ja":a={dow:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"],dowShort:["日","月","火","水","木","金","土"],month:["3月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]};break;case"ko":a={dow:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"],dowShort:["일","월","화","수","목","금","토"],month:["일월","이월","삼월","사월","오월","유월","칠월","팔월","구월","시월","십일월","십이월"]};break;case"zh":a={dow:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dowShort:["日","一","二","三","四","五","六"],month:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}}return a[e]}}(jQuery);