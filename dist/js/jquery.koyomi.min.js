!function(n){"use strict";var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),s={init:function(t){var a=n.extend(!0,{year:e.getFullYear(),month:e.getMonth()+1,headLabel:"%year% %month%",prevNext:!0,prevSign:"＜",nextSign:"＞",useJapaneseEra:0,japaneseEras:[{name:"明治",firstDate:"1868-01-25",lastDate:"1912-07-29"},{name:"大正",firstDate:"1912-07-30",lastDate:"1926-12-24"},{name:"昭和",firstDate:"1926-12-25",lastDate:"1989-01-07"},{name:"平成",firstDate:"1989-01-08"}],weekBeginning:0,weekdayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],weekdayClass:["sun","mon","tue","wed","thu","fri","sat"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],url:"http://example.com/%year%/%month%/%day%/",eventDates:{dates:[],yearly:[],monthly:[]}},t);return this.each(function(){var t=n(this),e=i(t,a),s=new r(t,e);s.settings.FirstDay=new Date(s.settings.year,s.settings.month-1,1),s.settings.LastDay=new Date(s.settings.year,s.settings.month,0),s.buildKoyomi(),s.load(),n(t).on("click","div.prev,div.next",function(){switch(!0){case"prev"===n(this).attr("class"):s.settings.month=s.settings.month-1;break;case"next"===n(this).attr("class"):s.settings.month=s.settings.month+1}s.settings.FirstDay=new Date(s.settings.year,s.settings.month-1,1),s.settings.LastDay=new Date(s.settings.year,s.settings.month,0),t.empty(),s.buildKoyomi(),s.load()}),n(t).on("click","div.number",function(){window.location.href=$(this).data("url")})})}},o=function(t,e){var s=t;return{getWeekNum:function(){return(s+e)%7},getCellNum:function(){return s%7},countUp:function(){return s++}}};n.fn.koyomi=function(t){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void n.error("Method "+t+" does not exist on jQuery.koyomi"):s.init.apply(this,arguments)};var a,i=function(t,e){return n.extend(!0,{},e,t.data())},g=function(t,e){return(Array(e).join("0")+t).slice(-e)},l=function(t){var e=t.split("-");return new Date(e[0],e[1]-1,e[2])},r=(a=function(t,e){this.$el=t,this.settings=e},n.extend(a.prototype,{},{load:function(){var s=this.$el,a=this.settings;$.each(a.eventDates.dates,function(t,e){$(s).find(".date_"+e.date).addClass(e.class?e.class:"eventday")}),$.each(a.eventDates.yearly,function(t,e){$(s).find(".date_"+a.FirstDay.getFullYear()+"-"+e.date).addClass(e.class?e.class:"eventday")}),$.each(a.eventDates.monthly,function(t,e){$(s).find(".date_"+a.FirstDay.getFullYear()+"-"+g(a.FirstDay.getMonth()+1,2)+"-"+g(e.date,2)).addClass(e.class?e.class:"eventday")}),$(s).find(".date_"+t.getFullYear()+"-"+g(t.getMonth()+1,2)+"-"+g(t.getDate(),2)).addClass("today")},buildKoyomi:function(){var t="";t+='<div class="koyomi">',t+="<table>",t+=this.buildHead(),t+=this.buildMain(),t+="</table>",t+="</div>",this.$el.append(t)},buildHead:function(){var t=this.settings.headLabel;t=(t=t.replace("%month%",this.settings.monthNames[this.settings.FirstDay.getMonth()])).replace("%year%",this.settings.FirstDay.getFullYear()),this.settings.useJapaneseEra&&(t=t.replace("%era%",this.getJapaneseEra()));var e=7,s=$("<tr></tr>");return this.settings.prevNext&&(e=5,s.append($("<td></td>").append($('<div class="prev"></div>').text(this.settings.prevSign)))),$(s).append($('<td colspan="'+e+'">').append($('<div class="headLabel"></div>').text(t))),this.settings.prevNext&&s.append($("<td></td>").append($('<div class="next"></div>').text(this.settings.nextSign))),$("<thead></thead>").append(s).prop("outerHTML")},buildMain:function(){new Date(this.settings.FirstDay.getFullYear(),this.settings.FirstDay.getMonth()+1,0);var t=o(0,this.settings.weekBeginning),s=this.initWeekObject(),e=$("<tbody></tbody>"),a=$("<tr></tr>");if(Object.keys(s).forEach(function(t,e){a.append($("<th></th>").addClass(s[t].class).text(s[t].name))}),$(e).append(a),this.settings.weekBeginning!=this.settings.FirstDay.getDay())for(a=$("<tr></tr>");t.getWeekNum()!=this.settings.FirstDay.getDay();)a.append($("<td></td>").addClass(this.settings.weekdayClass[t.getWeekNum()])),t.countUp();for(var n=1;n<=this.settings.LastDay.getDate();n++){var i=new Date(this.settings.FirstDay.getFullYear(),this.settings.FirstDay.getMonth(),n);t.getCellNum()||(a=$("<tr></tr>"));var r=[];r.push(this.settings.weekdayClass[t.getWeekNum()]),r.push("date_"+i.getFullYear()+"-"+g(i.getMonth()+1,2)+"-"+g(i.getDate(),2));var d=this.settings.url;d=(d=(d=d.replace("%year%",this.settings.FirstDay.getFullYear())).replace("%month%",this.settings.FirstDay.getMonth()+1)).replace("%day%",n);var l=$("<div></div>").attr("data-url",d).addClass("number").text(n);a.append($("<td></td>").addClass(r.join(" ")).append(l)),t.countUp(),t.getCellNum()||e.append(a)}if(t.getCellNum()){for(;t.getCellNum();)a.append($("<td></td>").addClass(this.settings.weekdayClass[t.getWeekNum()])),t.countUp();e.append(a)}return e.prop("outerHTML")},initWeekObject:function(){for(var t=o(this.settings.weekBeginning,this.settings.weekBeginning),e=new Object,s=0;s<7;s++)e[s]={name:this.settings.weekdayNames[t.getCellNum()],class:this.settings.weekdayClass[t.getCellNum()]},t.countUp();return e},getWeekDay:function(){return this.settings.weekdayClass[weeknumber]},getJapaneseEra:function(){var r=this.settings,d=[];return $.each(r.japaneseEras,function(t,e){var s,a,n=l(e.firstDate);if(void 0!==e.lastDate)var i=l(e.lastDate);switch(!0){case n.getTime()<=r.LastDay.getTime()&&void 0===e.lastDate:case n.getTime()<=r.FirstDay.getTime()&&i.getTime()>=r.FirstDay.getTime():d.push((s=e.name,1==(a=r.FirstDay.getFullYear()+1-n.getFullYear())?s+"元年":s+a+"年"))}}),d.join("/")},_bind:function(t){var e=this;return function(){e[t].apply(e,arguments)}}}),a)}(jQuery);